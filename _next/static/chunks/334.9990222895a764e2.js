(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[334],{3334:(e,s,t)=>{"use strict";t.r(s),t.d(s,{LG_COL:()=>v,XS_COL:()=>f,default:()=>S,getUnlockedComics:()=>N,unlockComic:()=>A,unlockComics:()=>C});var i=t(7876),r=t(4232),c=t(9589),a=t(6970),n=t(7784),l=t(5858),o=t.n(l),d=t(9099),h=t(8230),m=t.n(h),p=t(1772),u=t(1041),_=t(9742);let g="1"===_.env.NEXT_PUBLIC_COMICS_UNLOCK_ALL,j="1"===_.env.NEXT_PUBLIC_ARCHIVE_COMICS_COUNT,x="1"===_.env.NEXT_PUBLIC_ARCHIVE_COMMENT_ICONS,f=12,v=8;function y(e){return`comic-${e.id}-unlocked`}function N(e){return e.map(e=>{let s=y(e);try{return"1"===localStorage.getItem(s)}catch(e){return console.error(e),!0}})}function A(e){try{localStorage.setItem(y(e),"1")}catch(e){console.error(e)}}function C(e){e.forEach(e=>A(e))}class I extends r.Component{static propTypes;constructor(e){super(e),this.state={input:""},this.onKeyUp=this.onKeyUp.bind(this),this.onTimeout=this.onTimeout.bind(this)}componentDidMount(){document.addEventListener("keyup",this.onKeyUp)}componentWillUnmount(){document.removeEventListener("keyup",this.onKeyUp),void 0!==this.state.timeoutId&&clearTimeout(this.state.timeoutId)}onKeyUp(e){void 0!==this.state.timeoutId&&clearTimeout(this.state.timeoutId);let s=this.state.input+e.code;s.includes("ArrowUpArrowUpArrowDownArrowDownArrowLeftArrowRightArrowLeftArrowRight")?(C(this.props.comics),alert("Vous avez d\xe9bloqu\xe9 tous les comics !"),this.onTimeout()):this.setState({input:s,timeoutId:window.setTimeout(this.onTimeout,500)})}onTimeout(){this.setState({input:""})}renderCategories(e){let s=s=>(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:o().icon,style:{backgroundImage:`url("${s.category.src}")`}}),(0,i.jsxs)("span",{className:o().title,children:[s.category.title,j?(0,i.jsx)("span",{children:`(${e.getCount(s)})`}):(0,i.jsx)(i.Fragment,{}),x&&this.props.comics.filter(e=>e.categoryIds.includes(s.category.id)).every(e=>""!==e.commentary)?(0,i.jsx)("span",{style:{marginLeft:"0.5em"},children:(0,i.jsx)(r.Suspense,{fallback:(0,i.jsx)(i.Fragment,{}),children:(0,i.jsx)(p.g,{className:o().commentary_icon,icon:u.Bep})})}):(0,i.jsx)(i.Fragment,{})]})]});return(0,i.jsx)("ul",{className:o().filters_list,children:e.categories.map(t=>(0,i.jsx)("li",{className:[o().item,e.isSelected(t)?o().selected:"",e.isDisabled(t)?o().disabled:""].join(" "),children:e.isDisabled(t)?(0,i.jsx)("div",{className:o().item_wrapper,children:s(t)}):(0,i.jsx)(m(),{className:o().item_wrapper,href:e.getHref(t),children:s(t)})},t.category.id))})}renderSeries(e){return this.renderCategories({categories:e.series.map(e=>({category:e.metadata,seriesIds:[e.metadata.id]})),isSelected:e.isSelected,isDisabled:e.isDisabled,getCount:e.getCount,getHref:e.getHref})}renderComics(e){let s=N(e);return(0,i.jsx)("ul",{className:o().comics_list,children:e.map((e,t)=>(0,i.jsx)("li",{className:o().item,children:(0,i.jsxs)(m(),{className:o().link,href:e.href,children:[(0,i.jsx)("div",{className:[o().icon,o().locked].join(" "),style:{...g||s[t]?{backgroundImage:`url("${e.src}")`}:{},aspectRatio:`${e.width}/${e.height}`},children:g||s[t]?(0,i.jsx)(i.Fragment,{}):(0,i.jsx)(r.Suspense,{fallback:(0,i.jsx)(i.Fragment,{}),children:(0,i.jsx)(p.g,{className:o().lock_icon,icon:u.DW4})})}),(0,i.jsx)("span",{className:o().title_wrapper,children:(0,i.jsxs)("span",{className:o().title,children:[g||s[t]?e.title:"???",x&&""!==e.commentary?(0,i.jsx)("span",{style:{marginLeft:"0.5em"},children:(0,i.jsx)(r.Suspense,{fallback:(0,i.jsx)(i.Fragment,{}),children:(0,i.jsx)(p.g,{className:o().commentary_icon,icon:u.Bep})})}):(0,i.jsx)(i.Fragment,{})]})})]})},e.id))})}renderPages(e){return(0,i.jsx)("ul",{className:o().pages_list,children:[...Array(e.numPages).keys()].map(e=>e+1).map(s=>(0,i.jsx)("li",{className:[o().page_item,e.currentPage===s?o().selected:""].join(" "),children:(0,i.jsx)(m(),{href:e.getHref(s),children:s})},s.toString()))})}render(){let{className:e,router:s,currentCategoryId:t}=this.props,{query:r}=s,l=this.props.currentSeriesId?this.props.series.find(e=>e.metadata.id===this.props.currentSeriesId):void 0,d=this.props.currentSeriesId??"all",h=l?.categories?.find(e=>e.id===t),m=Number(r.page);Number.isNaN(m)&&(m=1);let p=this.props.comics.filter(e=>void 0===h||e.categoryIds.includes(h.id)),u=Math.max(Math.ceil(p.length/15),1);return p=p.slice((m-1)*15,15*m),(0,i.jsxs)(c.A,{className:[e||"",o().archive,"external_container"].join(" "),children:[(0,i.jsx)(a.A,{className:"justify-content-center",children:(0,i.jsxs)(n.A,{className:o().filters_col,xs:f,lg:v,children:[this.renderSeries({series:this.props.series,isSelected:e=>{let{category:s}=e;return s.id===d},isDisabled:()=>!1,getCount:()=>this.props.comics.length,getHref:e=>{let{category:s}=e;return`/archive${s.id===d?"":`/${s.id}`}`}}),...Object.values(Object.fromEntries(function(e,s){let t=new Map;return e.forEach(e=>{let i=s(e),r=t.get(i);r?r.push(e):t.set(i,[e])}),t}(Object.values(this.props.series.reduce((e,s)=>(s.categories.forEach(t=>{void 0===e[t.id]&&(e[t.id]={category:t,seriesIds:[]}),e[t.id].seriesIds.push(s.metadata.id)}),e),{})),e=>{let{category:s}=e;return s.row}))).map(e=>this.renderCategories({categories:e,isSelected:e=>{let{category:s}=e;return s.id===t},isDisabled:e=>{let{seriesIds:s}=e;return void 0!==l&&!s.includes(d)},getCount:e=>{let{category:s}=e;return this.props.comics.filter(e=>e.categoryIds.includes(s.id)).length},getHref:e=>`/archive${e.category.id===t?void 0!==d&&"all"!==d?`/${d}`:"":`/${d}/${e.category.id}`}`}))]})}),(0,i.jsx)(a.A,{className:"justify-content-center",children:(0,i.jsx)(n.A,{xs:f,lg:v,children:this.renderComics(p)})}),(0,i.jsx)(a.A,{className:"justify-content-center",children:(0,i.jsx)(n.A,{className:o().pages_col,xs:f,lg:v,children:this.renderPages({numPages:u,currentPage:m,getHref:e=>({pathname:`/archive${this.props.currentSeriesId?`/${this.props.currentSeriesId}${t?`/${t}`:""}`:""}`,query:{page:e.toString()}})})})})]})}}I.propTypes={};let S=(0,d.withRouter)(I)},5858:e=>{e.exports={archive:"Archive_archive__cbfaC",selected:"Archive_selected__G04vY",icon:"Archive_icon__9dnQO",item:"Archive_item__26pu_",disabled:"Archive_disabled__KeEJf",filters_col:"Archive_filters_col__YqrT_",filters_list:"Archive_filters_list__7G4QR",item_wrapper:"Archive_item_wrapper__djda_",title:"Archive_title__OSZlL",comics_list:"Archive_comics_list__2M8Xx",title_wrapper:"Archive_title_wrapper__LOt2f",locked:"Archive_locked__1LcGT",lock_icon:"Archive_lock_icon__pe1zg",pages_col:"Archive_pages_col__Xm2hR",pages_list:"Archive_pages_list__rWv1H"}},9099:(e,s,t)=>{e.exports=t(8253)}}]);