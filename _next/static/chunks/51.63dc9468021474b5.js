(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[51],{1051:(e,t,s)=>{"use strict";s.r(t),s.d(t,{LG_COL:()=>C,XS_COL:()=>A,default:()=>L,getUnlockedComics:()=>S,unlockComic:()=>b,unlockComics:()=>w});var i,r=s(467),c=s(1893),n=s(5456),a=s(4848),o=s(6540),l=s(848),d=s(6871),h=s(1849),m=s(9753),p=s.n(m),u=s(6715),_=s(1106),g=s.n(_),j=s(3914),v=s(6188),x=s(5606);let f="1"===x.env.NEXT_PUBLIC_COMICS_UNLOCK_ALL,y="1"===x.env.NEXT_PUBLIC_ARCHIVE_COMICS_COUNT,N="1"===x.env.NEXT_PUBLIC_ARCHIVE_COMMENT_ICONS,A=12,C=8;function I(e){return"comic-".concat(e.id,"-unlocked")}function S(e){return e.map(e=>{let t=I(e);try{return"1"===localStorage.getItem(t)}catch(e){return console.error(e),!0}})}function b(e){try{localStorage.setItem(I(e),"1")}catch(e){console.error(e)}}function w(e){e.forEach(e=>b(e))}class k extends(i=o.Component){componentDidMount(){document.addEventListener("keyup",this.onKeyUp)}componentWillUnmount(){document.removeEventListener("keyup",this.onKeyUp),void 0!==this.state.timeoutId&&clearTimeout(this.state.timeoutId)}onKeyUp(e){void 0!==this.state.timeoutId&&clearTimeout(this.state.timeoutId);let t=this.state.input+e.code;t.includes("ArrowUpArrowUpArrowDownArrowDownArrowLeftArrowRightArrowLeftArrowRight")?(w(this.props.comics),alert("Vous avez d\xe9bloqu\xe9 tous les comics !"),this.onTimeout()):this.setState({input:t,timeoutId:window.setTimeout(this.onTimeout,500)})}onTimeout(){this.setState({input:""})}renderCategories(e){let t=t=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:p().icon,style:{backgroundImage:'url("'.concat(t.category.src,'")')}}),(0,a.jsxs)("span",{className:p().title,children:[t.category.title,y?(0,a.jsx)("span",{children:"(".concat(e.getCount(t),")")}):(0,a.jsx)(a.Fragment,{}),N&&this.props.comics.filter(e=>e.categoryIds.includes(t.category.id)).every(e=>""!==e.commentary)?(0,a.jsx)("span",{style:{marginLeft:"0.5em"},children:(0,a.jsx)(o.Suspense,{fallback:(0,a.jsx)(a.Fragment,{}),children:(0,a.jsx)(j.g,{className:p().commentary_icon,icon:v.Bep})})}):(0,a.jsx)(a.Fragment,{})]})]});return(0,a.jsx)("ul",{className:p().filters_list,children:e.categories.map(s=>(0,a.jsx)("li",{className:[p().item,e.isSelected(s)?p().selected:"",e.isDisabled(s)?p().disabled:""].join(" "),children:e.isDisabled(s)?(0,a.jsx)("div",{className:p().item_wrapper,children:t(s)}):(0,a.jsx)(g(),{className:p().item_wrapper,href:e.getHref(s),children:t(s)})},s.category.id))})}renderSeries(e){return this.renderCategories({categories:e.series.map(e=>({category:e.metadata,seriesIds:[e.metadata.id]})),isSelected:e.isSelected,isDisabled:e.isDisabled,getCount:e.getCount,getHref:e.getHref})}renderComics(e){let t=S(e);return(0,a.jsx)("ul",{className:p().comics_list,children:e.map((e,s)=>(0,a.jsx)("li",{className:p().item,children:(0,a.jsxs)(g(),{className:p().link,href:e.href,children:[(0,a.jsx)("div",{className:[p().icon,p().locked].join(" "),style:(0,n._)((0,c._)({},f||t[s]?{backgroundImage:'url("'.concat(e.src,'")')}:{}),{aspectRatio:"".concat(e.width,"/").concat(e.height)}),children:f||t[s]?(0,a.jsx)(a.Fragment,{}):(0,a.jsx)(o.Suspense,{fallback:(0,a.jsx)(a.Fragment,{}),children:(0,a.jsx)(j.g,{className:p().lock_icon,icon:v.DW4})})}),(0,a.jsx)("span",{className:p().title_wrapper,children:(0,a.jsxs)("span",{className:p().title,children:[f||t[s]?e.title:"???",N&&""!==e.commentary?(0,a.jsx)("span",{style:{marginLeft:"0.5em"},children:(0,a.jsx)(o.Suspense,{fallback:(0,a.jsx)(a.Fragment,{}),children:(0,a.jsx)(j.g,{className:p().commentary_icon,icon:v.Bep})})}):(0,a.jsx)(a.Fragment,{})]})})]})},e.id))})}renderPages(e){return(0,a.jsx)("ul",{className:p().pages_list,children:[...Array(e.numPages).keys()].map(e=>e+1).map(t=>(0,a.jsx)("li",{className:[p().page_item,e.currentPage===t?p().selected:""].join(" "),children:(0,a.jsx)(g(),{href:e.getHref(t),children:t})},t.toString()))})}render(){var e,t;let{className:s,router:i,currentCategoryId:r}=this.props,{query:c}=i,n=this.props.currentSeriesId?this.props.series.find(e=>e.metadata.id===this.props.currentSeriesId):void 0,o=null!==(t=this.props.currentSeriesId)&&void 0!==t?t:"all",m=null==n?void 0:null===(e=n.categories)||void 0===e?void 0:e.find(e=>e.id===r),u=Number(c.page);Number.isNaN(u)&&(u=1);let _=this.props.comics.filter(e=>void 0===m||e.categoryIds.includes(m.id)),g=Math.max(Math.ceil(_.length/15),1);return _=_.slice((u-1)*15,15*u),(0,a.jsxs)(l.A,{className:[s||"",p().archive,"external_container"].join(" "),children:[(0,a.jsx)(d.A,{className:"justify-content-center",children:(0,a.jsxs)(h.A,{className:p().filters_col,xs:A,lg:C,children:[this.renderSeries({series:this.props.series,isSelected:e=>{let{category:t}=e;return t.id===o},isDisabled:()=>!1,getCount:()=>this.props.comics.length,getHref:e=>{let{category:t}=e;return"/archive".concat(t.id===o?"":"/".concat(t.id))}}),...Object.values(Object.fromEntries(function(e,t){let s=new Map;return e.forEach(e=>{let i=t(e),r=s.get(i);r?r.push(e):s.set(i,[e])}),s}(Object.values(this.props.series.reduce((e,t)=>(t.categories.forEach(s=>{void 0===e[s.id]&&(e[s.id]={category:s,seriesIds:[]}),e[s.id].seriesIds.push(t.metadata.id)}),e),{})),e=>{let{category:t}=e;return t.row}))).map(e=>this.renderCategories({categories:e,isSelected:e=>{let{category:t}=e;return t.id===r},isDisabled:e=>{let{seriesIds:t}=e;return void 0!==n&&!t.includes(o)},getCount:e=>{let{category:t}=e;return this.props.comics.filter(e=>e.categoryIds.includes(t.id)).length},getHref:e=>"/archive".concat(e.category.id===r?void 0!==o&&"all"!==o?"/".concat(o):"":"/".concat(o,"/").concat(e.category.id))}))]})}),(0,a.jsx)(d.A,{className:"justify-content-center",children:(0,a.jsx)(h.A,{xs:A,lg:C,children:this.renderComics(_)})}),(0,a.jsx)(d.A,{className:"justify-content-center",children:(0,a.jsx)(h.A,{className:p().pages_col,xs:A,lg:C,children:this.renderPages({numPages:g,currentPage:u,getHref:e=>({pathname:"/archive".concat(this.props.currentSeriesId?"/".concat(this.props.currentSeriesId).concat(r?"/".concat(r):""):""),query:{page:e.toString()}})})})})]})}constructor(e){super(e),this.state={input:""},this.onKeyUp=this.onKeyUp.bind(this),this.onTimeout=this.onTimeout.bind(this)}}(0,r._)(k,"propTypes",void 0),k.propTypes={};let L=(0,u.withRouter)(k)},9753:e=>{e.exports={archive:"Archive_archive__cbfaC",selected:"Archive_selected__G04vY",icon:"Archive_icon__9dnQO",item:"Archive_item__26pu_",disabled:"Archive_disabled__KeEJf",filters_col:"Archive_filters_col__YqrT_",filters_list:"Archive_filters_list__7G4QR",item_wrapper:"Archive_item_wrapper__djda_",title:"Archive_title__OSZlL",comics_list:"Archive_comics_list__2M8Xx",title_wrapper:"Archive_title_wrapper__LOt2f",locked:"Archive_locked__1LcGT",lock_icon:"Archive_lock_icon__pe1zg",pages_col:"Archive_pages_col__Xm2hR",pages_list:"Archive_pages_list__rWv1H"}},6715:(e,t,s)=>{e.exports=s(8440)}}]);